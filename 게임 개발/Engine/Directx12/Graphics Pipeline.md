# Graphics Pipeline

## 그래픽스 파이프라인?

그래픽스 파이프라인(Graphics Pipeline)은 그래픽스 프로그래밍에서 3D 모델을 화면에 렌더링하기까지의 과정을 나타내는 일련의 단계들의 집합이다.

이 파이프라인은 GPU에서 실행되며, 3D 모델의 정점 데이터를 화면에 표시 가능한 2D 이미지로 변환하는 데 사용된다. 그래픽스 파이프라인은 일반적으로 고정 기능 단계 (Fixed Function Stages)와 프로그램 가능 단계(Programmable Stages) 이 두가지로 나뉜다.

## 고정 기능 단계 (Fixed Function Stages) 

고정 기능 단계는 하드웨어에서 자동으로 수행되는 단계들이며, 프로그램 가능 단계는 사용자가 직접 프로그래밍하여 원하는 시각적 효과를 구현할 수 있는 단계들이다. 

1. **입력 어셈블리(Input Assembly)**
   - **정점 데이터 입력 :** 3D 모델의 정점 데이터가 그래픽스 파이프라인으로 입력된다.

2. **버텍스 쉐이더(Vertex Shader)**
   - **정점 변환(Transform) :** 정점 데이터는 3D 공간에서 화면 좌표로 변환 된다.
   
   - **조명 및 색상 계산 :** 정점의 조명이나 색상 계산이 수행된다.
   
3. **테셀레이션(Tessellation)**
   - **테셀레이션 제어 쉐이더 (Control Shader) :** 정점 데이터를 통해 새로운 정점들을 생성하고 테셀레이션 패치를 제어한다.
   - **테셀레이션 :** 테셀레이션 패치의 세부 수준을 조절하여 더 많은 정점을 생성한다.
   
4. **테셀레이션 평가 쉐이더(Tessellation Evaluation Shader)**
   - **테셀레이션된 정점의 최종 위치 계산 :** 테셀레이션 된 정점들의 최종 위치를 계산한다.

5. **기하 쉐이더(Geometry Shader)** 
   - **정점 및 프르미티브 생성 :** 정점 데이터나 프리미티브(점, 선, 삼각형 등)를 생성하거나 제거할 수 있다.

6. **클리핑 및 투영(Cliping and Projection)**
   - **클리핑 :** 화면을 벗어나는 부분을 제거한다.
   - **투영 변환 :** 3D 좌표를 2D 좌표로 변환한다.

7. **레스터라이제이션(Rasterization)**
   - **프래그먼트 생성 :** 화면 상의 픽셀들에 대응하는 프래그먼트를 생성한다.
   - **프래그먼트 보간 :** 정점에서 데이터를 기반으로 프래그먼트의 보간값을 계산한다.

8. **픽쉘 쉐이더(Pixel Shader)**
   - **텍스처 매핑 및 색상 계산 :** 텍스처 매핑, 조명 계산 등을 수행하여 최종 픽셀 색상을 계산한다.

9. **출력 병합 (Output Merger)**
   - **깊이 테스트와 스텐실 테스트 :** 픽셀의 깊이와 스텐실 값을 기반으로 픽셀을 최종적으로 출력할지를 결정한다.
   - **블렌딩 :** 여러 렌더 타겟의 결과를 결합하여 최종 이미지를 생성한다.

각 단계는 그자체로 중요한 역할을 수행하며, 개발자가 프로그래밍 가능한 단게에서는 필요에 따라 사용자 정의 효과를 추가할 수 있다. 프로그래밍 가능한 쉐이더를 사용하여 글미자, 반사, 반투명도, 등등과 같은 시각적 효과를 구현할 수 있다.

## 프로그램 가능 단계 (Programmable Stages)

프로그램 가능 단계에서는 사용자가 직접 쉐이더(Shader)를 작성하여 그림자, 조명, 텍스처 매핑, 반투명도, 그리고 사용자 정의 효과 등을 구현할 수 있다. 주로 두 가지 타입의 쉐이더가 사용된다.

1. **버텍스 쉐이더(Vertex Shader)** : 정점의 위치를 변환하고, 색상 및 조명과 같은 속성을 계산한다. 또한, 정점 데이터의 초기 설정을 수행한다.
2. **픽쉘 쉐이더(Pixel Shader)**  : 프래그먼트의 색상을 계산하고, 텍스처 매핑, 그림자 효과, 조명 등의 복잡한 그래픽스 효과를 구현한다.

프로그램 가능 단계에서의 쉐이더 작성은 사용자에게 많은 유연성을 제공한다. 즉 , 렌더링 파이프라인을 사용자가 원하는 방식으로 조작하고 개선할 수 있게 한다. 예를 들어, 쉐이더를 사용하여 다양한 머터리얼(Material) 효과를 적용하거나, 그림자 맵핑, 환경 매핑, 후처리 효과 등을 추가할 수도 있다.

사용자는 HLSL(High-Level Shading Language), GLSL(Graphics Library Shading Language), 또는 Vulkan에서 사용되는 SPIR-V 등의 쉐이더 언어를 사용하여 쉐이더를 작성하게 된다. 이렇게 작성된 쉐이더는 GPU에서 실행되어 각 정점과 픽셀에 대한 연산을 수행하게 된다. 이러한 사용자 지정 쉐이더를 통해 그래픽스 파이프라인은 다양한 시각적 효과를 얻을 수 있다.
